<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>فاست كوينز — حاسبة بيع العملات</title>
  <link href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;500;600;700&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    :root {
      --bg: #ffffff;
      --ink: #222222;
      --muted: #666666;
      --brand: #007D71;           /* الأخضر */
      --accent: #E3B701;          /* الذهبي */
      --accent-dark: #b99600;
      --light-bg: #f8f9fa;
      --border: #eaeaea;
      --gradient: linear-gradient(135deg, #007D71 0%, #009f90 100%);
      --gradient-gold: linear-gradient(135deg, #E3B701 0%, #f9d423 100%);
      --shadow: 0 10px 30px rgba(0,0,0,0.08);
      --shadow-hover: 0 15px 40px rgba(0,0,0,0.12);
      --radius: 16px;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      --danger: #e74c3c;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; scroll-behavior: smooth; }
    body {
      font-family: 'Tajawal', sans-serif;
      background: var(--bg);
      color: var(--ink);
      line-height: 1.7;
      overflow-x: hidden;
      font-weight: 400;
    }
    h1, h2, h3, h4, h5, h6 { font-family: 'El Messiri', serif; font-weight: 700; }
    a { color: inherit; text-decoration: none; transition: var(--transition); }
    .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    .row { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 16px; }
    
    /* رأس أنيق */
    .nav {
      position: sticky; top: 0; z-index: 100;
      background: rgba(255,255,255,0.98);
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      padding: 15px 0; transition: var(--transition);
      box-shadow: 0 5px 15px rgba(0,0,0,0.03);
    }
    .nav.scrolled { padding: 10px 0; }
    .brand { display: flex; align-items: center; gap: 14px; }
    .brand img {
      width: 50px; height: 50px; border-radius: 12px; object-fit: cover;
      border: 2px solid var(--accent); box-shadow: 0 0 20px rgba(227,183,1,.15);
      transition: var(--transition);
    }
    .brand:hover img { transform: rotate(5deg); }
    .brand b { font-weight: 800; font-size: 24px; color: var(--brand); letter-spacing: .5px; }
    
    /* زر أنيق */
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 14px 28px; border-radius: var(--radius);
      background: transparent; border: 1px solid var(--border);
      transition: var(--transition); font-weight: 600; position: relative; overflow: hidden;
      color: var(--ink); font-size: 16px; cursor: pointer;
    }
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(227,183,1,.1), transparent);
      transition: .5s;
    }
    .btn:hover::before { left: 100%; }
    .btn:hover { transform: translateY(-2px); border-color: var(--accent); box-shadow: var(--shadow-hover); }
    .btn.whatsapp { background: var(--gradient); color: #fff; font-weight: 600; border: 0; }
    .btn.whatsapp:hover { box-shadow: 0 8px 20px rgba(0,125,113,.25); transform: translateY(-2px); }
    .btn.accent { background: var(--gradient-gold); color: #fff; border: 0; }
    
    /* بطل */
    .hero {
      padding: 100px 0 60px; position: relative; overflow: hidden;
      background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
      border-radius: 0 0 var(--radius) var(--radius); text-align: center;
    }
    .hero::before {
      content: ''; position: absolute; top: -50%; right: -20%;
      width: 500px; height: 500px;
      background: radial-gradient(circle, rgba(227,183,1,.08) 0%, transparent 70%); z-index: 0;
    }
    .hero::after {
      content: ''; position: absolute; bottom: -10%; left: -10%;
      width: 300px; height: 300px;
      background: radial-gradient(circle, rgba(0,125,113,.08) 0%, transparent 70%); z-index: 0;
    }
    .headline { 
      font-size: 2.8rem; line-height: 1.2; margin: 0; color: var(--brand); font-weight: 800; letter-spacing: -0.5px; position: relative;
      display: inline-block;
    }
    .headline::after {
      content: ''; position: absolute; bottom: -10px; right: 50%; transform: translateX(50%);
      width: 60px; height: 4px; background: var(--gradient-gold); border-radius: 2px;
    }
    .accent-text { color: var(--accent); position: relative; display: inline-block; }
    .accent-text::after { content: ''; position: absolute; bottom: 5px; left: 0; width: 100%; height: 8px; background: rgba(227,183,1,.2); z-index: -1; border-radius: 4px; }
    .sub { color: var(--muted); margin: 20px 0 30px; font-size: 1.2rem; max-width: 800px; margin-inline: auto; line-height: 1.8; font-weight: 400; }
    
    /* بطاقة الحاسبة */
    .calculator-card {
      background: white; border: 1px solid var(--border); border-radius: var(--radius);
      box-shadow: var(--shadow); padding: 30px; transition: var(--transition); margin: 30px 0;
      position: relative; overflow: hidden;
    }
    .calculator-card::before {
      content: ''; position: absolute; top: 0; left: 0; width: 5px; height: 100%; background: var(--gradient); transition: var(--transition);
    }
    .calculator-card:hover { box-shadow: var(--shadow-hover); transform: translateY(-3px); }
    .calculator-card:hover::before { width: 8px; }

    .form-group { margin-bottom: 20px; position: relative; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--brand); }
    .form-control, .form-select {
      width: 100%; padding: 14px 16px; border: 1px solid var(--border);
      border-radius: var(--radius); font-size: 16px; font-family: 'Tajawal', sans-serif;
      transition: var(--transition); background: #fff;
    }
    .form-control:focus, .form-select:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px rgba(227,183,1,.2); }

    /* إبراز الحقول الفارغة */
    .invalid { border-color: var(--danger) !important; box-shadow: 0 0 0 3px rgba(231,76,60,.12) !important; outline: 2px solid rgba(231,76,60,.35); outline-offset: 2px; }
    @keyframes shake {
      10%, 90% { transform: translateX(-1px); }
      20%, 80% { transform: translateX(2px); }
      30%, 50%, 70% { transform: translateX(-4px); }
      40%, 60% { transform: translateX(4px); }
    }
    .shake { animation: shake .4s linear both; }

    /* نتيجة الحساب */
    .result-box {
      background: var(--light-bg); border-radius: var(--radius);
      padding: 20px; margin: 25px 0; text-align: center; border: 1px dashed var(--brand);
    }
    .result-title { font-size: 18px; color: var(--muted); margin-bottom: 10px; }
    .result-value { font-size: 28px; font-weight: 700; color: var(--brand); }
    .note { display:block; margin-top:6px; color:#888; font-size:12px; }

    /* طرق الإيداع */
    .deposit-methods {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;
    }
    @media (max-width: 768px) { .deposit-methods { grid-template-columns: repeat(2, 1fr); } }
    .method-item {
      border: 2px solid var(--border); border-radius: var(--radius); padding: 15px;
      text-align: center; cursor: pointer; transition: var(--transition); position: relative; overflow: hidden;
    }
    .method-item::before {
      content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(0,125,113,0.03) 0%, rgba(227,183,1,0.03) 100%);
    }
    .method-item:hover { border-color: var(--accent); transform: translateY(-3px); }
    .method-item.selected { border-color: var(--brand); background: rgba(0,125,113,.05); }
    .method-icon { font-size: 30px; margin-bottom: 10px; color: var(--brand); position: relative; z-index: 1; }
    
    /* منصات الاستلام */
    .platforms-grid {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;
    }
    @media (max-width: 768px) { .platforms-grid { grid-template-columns: repeat(2, 1fr); } }
    .platform-item {
      border: 2px solid var(--border); border-radius: var(--radius); padding: 15px;
      text-align: center; cursor: pointer; transition: var(--transition); position: relative; overflow: hidden;
    }
    .platform-item::before {
      content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, rgba(0,125,113,0.03) 0%, rgba(227,183,1,0.03) 100%);
    }
    .platform-item:hover { border-color: var(--accent); transform: translateY(-3px); }
    .platform-item.selected { border-color: var(--brand); background: rgba(0,125,113,.05); }

    /* شعارات (من الويب) */
    .platform-logo{
      width:56px; height:56px; border-radius:14px; background:#fff;
      border:1px solid var(--border); display:grid; place-items:center;
      margin:0 auto 10px; overflow:hidden; position: relative; z-index: 1;
    }
    .platform-logo img{ width:80%; height:80%; object-fit:contain }

    /* شبكات التحويل */
    .networks{ margin-top:12px; display:none; gap:10px; flex-wrap:wrap; justify-content:center; }
    .net-tag{
      background: rgba(0,125,113,.06); border:1px solid var(--border);
      padding:8px 12px; border-radius:999px; font-size:13px; cursor:pointer; user-select:none; transition: var(--transition);
    }
    .net-tag:hover { background: rgba(0,125,113,.1); border-color: var(--accent); }
    .net-tag input{ margin-left:6px; transform:translateY(1px) }

    /* تفاصيل المحفظة */
    .wallet-details { display:none; margin-top:14px }
    .wallet-details small{ color:#999; display:block; margin-top:6px }

    /* نافذة التأكيد */
    .modal-overlay {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center;
      z-index: 1000; opacity: 0; visibility: hidden; transition: var(--transition);
      padding: 16px;
    }
    .modal-overlay.active { opacity: 1; visibility: visible; }
    .modal-content {
      background: white; border-radius: var(--radius); padding: 30px; width: 90%; max-width: 500px;
      transform: translateY(20px); transition: var(--transition); box-shadow: var(--shadow-hover); position: relative; overflow: hidden;
    }
    .modal-content::before { content: ''; position: absolute; top: 0; right: 0; width: 100%; height: 5px; background: var(--gradient); }
    .modal-overlay.active .modal-content { transform: translateY(0); }
    .modal-title { font-size: 24px; margin-bottom: 12px; color: var(--brand); text-align: center; }
    .summary{
      background: var(--light-bg); border:1px dashed var(--border); border-radius: 12px;
      padding:12px 14px; font-size:14px; color:#444; line-height:1.9; margin-bottom:10px;
    }
    .modal-buttons { display: flex; gap: 15px; justify-content: center; margin-top: 12px; }

    /* نافذة الأخطاء (منبثقة) */
    .error-overlay{ position: fixed; inset:0; background: rgba(0,0,0,.7); display:flex; align-items:center; justify-content:center; z-index:1100; opacity:0; visibility:hidden; transition:var(--transition); padding:16px }
    .error-overlay.active{ opacity:1; visibility:visible }
    .error-box{ background:#fff; border-radius:16px; width:90%; max-width:480px; box-shadow:var(--shadow-hover); padding:22px; border:1px solid var(--border) }
    .error-title{ font-size:20px; font-weight:800; color:var(--danger); margin-bottom:8px; text-align:center }
    .error-msg{ color:#555; text-align:center; line-height:1.9 }
    .error-actions{ display:flex; gap:10px; justify-content:center; margin-top:14px; flex-wrap:wrap }

    /* تذييل */
    footer {
      padding: 40px 0; background: var(--light-bg); border-top: 1px solid var(--border);
      text-align: center; margin-top: 50px; position: relative;
    }
    footer::before{
      content:''; position:absolute; inset:0;
      background-image:url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23007d71' fill-opacity='0.05' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
      z-index:0;
    }
    .footer-content { position:relative; z-index:1; display:flex; justify-content:center; align-items:center; flex-direction:column; gap:15px; }
    .social-links { display: flex; gap: 15px; margin-top: 20px; }
    .social-links a {
      width: 40px; height: 40px; border-radius: 50%; background: white; display: grid; place-items: center;
      box-shadow: var(--shadow); transition: var(--transition); color: var(--brand);
    }
    .social-links a:hover { transform: translateY(-3px); box-shadow: var(--shadow-hover); color: var(--accent); }
    
    /* زر واتساب عائم */
    .wa-float {
      position: fixed; left: 25px; bottom: 25px; z-index: 1000; box-shadow: var(--shadow-hover);
      animation: pulse 2s infinite; padding: 17px 20px; border-radius: 50px;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(0,125,113,0.5); }
      70% { box-shadow: 0 0 0 15px rgba(0,125,113,0); }
      100% { box-shadow: 0 0 0 0 rgba(0,125,113,0); }
    }
    
    /* تأثيرات */
    .fade-in { opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease, transform 0.8s ease; }
    .fade-in.visible { opacity: 1; transform: translateY(0); }
    
    /* responsive */
    @media (max-width: 768px) {
      .container { padding: 15px; }
      .calculator-card { padding: 20px; }
      .brand b { font-size: 20px; }
      .btn { padding: 12px 20px; font-size: 14px; }
      .headline { font-size: 2.2rem; }
    }
  </style>
</head>
<body>
  <!-- رأس -->
  <nav class="nav">
    <div class="container row">
      <div class="brand">
        <img src="1لوجو.jpg" alt="شعار فاست كوينز">
        <b>فاست كوينز</b>
      </div>
      <a class="btn whatsapp"
         href="https://wa.me/967781400883"
         target="_blank"><i class="fab fa-whatsapp"></i> تواصل معنا</a>
    </div>
  </nav>

  <!-- بطل -->
  <header class="container hero">
    <h1 class="headline">حاسبة <span class="accent-text">بيع العملات</span></h1>
    <p class="sub">احسب قيمت  عملاتك وأرسل طلبك مباشرة عبر الواتساب</p>
  </header>

  <!-- محتوى -->
  <div class="container">
    <div class="calculator-card">
      <!-- معلومات العميل -->
      <div class="form-group">
        <label for="clientName"><i class="fas fa-user"></i> الاسم بالكامل</label>
        <input type="text" id="clientName" class="form-control" placeholder="أدخل اسمك بالكامل">
      </div>
      <div class="form-group">
        <label for="clientPhone"><i class="fas fa-phone"></i> رقم الجوال</label>
        <input type="tel" id="clientPhone" class="form-control" placeholder="أدخل رقم جوالك">
      </div>
      
      <!-- العملة والمبلغ -->
      <div class="form-group">
        <label for="currency"><i class="fas fa-money-bill-wave"></i> العملة التي تريد بيعها (المبلغ المُدخل بهذه العملة)</label>
        <select id="currency" class="form-select">
          <option value="usd">دولار أمريكي (USD)</option>
          <option value="sar">ريال سعودي (SAR)</option>
        </select>
      </div>
      <div class="form-group">
        <label for="amount"><i class="fas fa-coins"></i> المبلغ</label>
        <input type="text" id="amount" class="form-control" placeholder="أدخل المبلغ (يدعم ١٢٣ والفواصل)" oninput="calculateResult()">
      </div>
      <div class="form-group">
        <label for="outCur"><i class="fas fa-calculator"></i> استلم المبلغ بـ</label>
        <select id="outCur" class="form-select" onchange="calculateResult()">
          <option value="yer" selected>YER (ريال يمني)</option>
          <option value="usd">USD (دولار أمريكي)</option>
        </select>
      </div>
      
      <!-- نتيجة -->
      <div class="result-box">
        <div class="result-title">القيمة المتوقعة (سعر بيع):</div>
        <div class="result-value" id="resultValue">0</div>
        <small class="note">السعر قابل للتفاوض حسب السيولة والرسوم.</small>
      </div>
      
      <!-- طرق الاستلام -->
      <div class="form-group">
        <label><i class="fas fa-wallet"></i> اختر طريقة الاستلام</label>
        <div class="deposit-methods">
          <div class="method-item" onclick="selectMethod(this, 'جيب')">
            <div class="method-icon"><i class="fas fa-wallet"></i></div><div>جيب</div>
          </div>
          <div class="method-item" onclick="selectMethod(this, 'جوالي')">
            <div class="method-icon"><i class="fas fa-wallet"></i></div><div>جوالي</div>
          </div>
          <div class="method-item" onclick="selectMethod(this, 'كاش')">
            <div class="method-icon"><i class="fas fa-wallet"></i></div><div>كاش</div>
          </div>
          <div class="method-item" onclick="selectMethod(this, 'ONE كاش')">
            <div class="method-icon"><i class="fas fa-wallet"></i></div><div>ONE كاش</div>
          </div>
          <div class="method-item" onclick="selectMethod(this, 'محفضتي')">
            <div class="method-icon"><i class="fas fa-wallet"></i></div><div>محفضتي</div>
          </div>
          <div class="method-item" onclick="selectMethod(this, 'مبايل موني')">
            <div class="method-icon"><i class="fas fa-wallet"></i></div><div>مبايل موني</div>
          </div>
          <div class="method-item" onclick="selectMethod(this, 'تحويل داخلي')">
            <div class="method-icon"><i class="fas fa-wallet"></i></div><div>تحويل داخلي</div>
          </div>
          <div class="method-item" onclick="selectMethod(this, 'تحويل خارجي')">
            <div class="method-icon"><i class="fas fa-wallet"></i></div><div>تحويل خارجي</div>
          </div>
        </div>
        <input type="hidden" id="selectedMethod">
      </div>
      
      <!-- المنصة + الشبكات -->
      <div class="form-group">
        <label><i class="fas fa-plug"></i> المنصة التي سترسل منها الرصيد</label>
        <div class="platforms-grid">
          <div class="platform-item" onclick="selectPlatform(this, 'Binance')">
            <div class="platform-logo"><img src="https://logo.clearbit.com/binance.com" alt="Binance"></div>
            <div>باينانس</div>
          </div>
          <div class="platform-item" onclick="selectPlatform(this, 'Bybit')">
            <div class="platform-logo"><img src="https://logo.clearbit.com/bybit.com" alt="Bybit"></div>
            <div>باي بيت</div>
          </div>
          <div class="platform-item" onclick="selectPlatform(this, 'Kucoin')">
            <div class="platform-logo"><img src="https://logo.clearbit.com/kucoin.com" alt="KuCoin"></div>
            <div>كوكوين</div>
          </div>
          <div class="platform-item" onclick="selectPlatform(this, 'OKX')">
            <div class="platform-logo"><img src="https://logo.clearbit.com/okx.com" alt="OKX"></div>
            <div>أوكي إكس</div>
          </div>
          <div class="platform-item" onclick="selectPlatform(this, 'Trust Wallet')">
            <div class="platform-logo"><img src="https://logo.clearbit.com/trustwallet.com" alt="Trust Wallet"></div>
            <div>ترست وولت</div>
          </div>
          <div class="platform-item" onclick="selectPlatform(this, 'MetaMask')">
            <div class="platform-logo"><img src="https://logo.clearbit.com/metamask.io" alt="MetaMask"></div>
            <div>ميتا ماسك</div>
          </div>
          <div class="platform-item" onclick="selectPlatform(this, 'PayPal')">
            <div class="platform-logo"><img src="https://logo.clearbit.com/paypal.com" alt="PayPal"></div>
            <div>باي بال</div>
          </div>
          <div class="platform-item" onclick="selectPlatform(this, 'Payeer')">
            <div class="platform-logo"><img src="https://logo.clearbit.com/payeer.com" alt="Payeer"></div>
            <div>بايير</div>
          </div>
        </div>

        <!-- شبكات التحويل (للكريبتو فقط) -->
        <div class="networks" id="networks">
          <div class="net-title">اختر الشبكة:</div>
          <label class="net-tag"><input type="radio" name="net" value="TRC20" onchange="setNetwork(this)"> TRC20</label>
          <label class="net-tag"><input type="radio" name="net" value="ERC20" onchange="setNetwork(this)"> ERC20</label>
          <label class="net-tag"><input type="radio" name="net" value="BEP20" onchange="setNetwork(this)"> BEP20</label>
        </div>

        <!-- بيانات المحفظة الدولية (دَيناميك) -->
        <div class="form-group wallet-details" id="walletDetails">
          <label id="walletLabel"><i class="fas fa-id-card"></i> بيانات المحفظة الدولية</label>
          <input type="text" id="walletId" class="form-control" placeholder="">
          <div style="height:10px"></div>
          <input type="text" id="walletNetwork" class="form-control" placeholder="">
          <small id="walletHint"></small>
        </div>

        <input type="hidden" id="selectedPlatform">
        <input type="hidden" id="selectedNetwork">
      </div>
      
      <!-- زر الإرسال -->
      <div style="text-align: center; margin-top: 30px;">
        <button class="btn whatsapp" onclick="confirmSend()">
          <i class="fab fa-whatsapp"></i> إرسال طلب البيع عبر الواتساب
        </button>
      </div>
    </div>
  </div>
  
  <!-- نافذة التأكيد -->
  <div class="modal-overlay" id="confirmModal">
    <div class="modal-content">
      <h2 class="modal-title">تأكيد الإرسال</h2>
      <div class="summary" id="summaryBox">—</div>
      <div class="modal-buttons">
        <button class="btn" onclick="closeModal()">رجوع</button>
        <button class="btn whatsapp" onclick="sendViaWhatsApp()">
          <i class="fab fa-whatsapp"></i> إرسال الآن
        </button>
      </div>
    </div>
  </div>

  <!-- نافذة الأخطاء -->
  <div class="error-overlay" id="errorModal" aria-hidden="true">
    <div class="error-box">
      <div class="error-title"><i class="fa-solid fa-triangle-exclamation" style="margin-left:6px"></i>تنبيه</div>
      <div class="error-msg" id="errorMsg">يرجى إكمال الحقل المطلوب.</div>
      <div class="error-actions">
        <button class="btn" onclick="closeError()">إلغاء</button>
        <button class="btn whatsapp" id="gotoFieldBtn"><i class="fa-solid fa-arrow-down"></i> الذهاب للحقل</button>
      </div>
    </div>
  </div>
  
  <!-- تذييل -->
  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="brand">
          <img src="1لوجو.jpg" alt="شعار فاست كوينز">
          <b>فاست كوينز</b>
        </div>
        <p>خدمات تحويل وبيع عملات فاخرة وسريعة</p>
        <div class="social-links">
          <a href="#"><i class="fab fa-facebook-f"></i></a>
          <a href="#"><i class="fab fa-instagram"></i></a>
          <a href="#"><i class="fab fa-twitter"></i></a>
          <a href="#"><i class="fab fa-whatsapp"></i></a>
        </div>
        <small>© <span id="year"></span> فاست كوينز — جميع الحقوق محفوظة.</small>
      </div>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // أسعار بيع ثابتة
    const exchangeRates = { usd: 537, sar: 139.5 };
    const CRYPTO_PLATFORMS = ['Binance','Bybit','Kucoin','OKX','Trust Wallet','MetaMask'];

    function normalizeNumber(str) {
      if (str == null) return 0;
      const arabicDigits = '٠١٢٣٤٥٦٧٨٩';
      let s = String(str).replace(/[,\s]/g,'').replace(/[^\d.\-٠-٩]/g,'');
      s = s.replace(/[٠-٩]/g, d => arabicDigits.indexOf(d));
      return parseFloat(s) || 0;
    }

    function calculateResult() {
      const cur = document.getElementById('currency').value;
      const out = document.getElementById('outCur').value;
      const amount = normalizeNumber(document.getElementById('amount').value);
      const rateYER = exchangeRates[cur];
      if (rateYER == null || isNaN(rateYER)) { document.getElementById('resultValue').textContent = '0'; return; }
      let result, unit;
      if (out === 'yer') { result = amount * rateYER; unit = 'YER'; }
      else { const yerAmount = amount * rateYER; result = yerAmount / exchangeRates.usd; unit = 'USD'; }
      document.getElementById('resultValue').textContent =
        result.toLocaleString('ar-EG', { maximumFractionDigits: 6 }) + ' ' + unit;
    }
    document.getElementById('currency').addEventListener('change', calculateResult);
    document.getElementById('amount').addEventListener('input', calculateResult);
    document.getElementById('outCur').addEventListener('change', calculateResult);
    calculateResult();

    function selectMethod(element, method) {
      document.querySelectorAll('.method-item').forEach(item => item.classList.remove('selected'));
      element.classList.add('selected');
      document.getElementById('selectedMethod').value = method;
    }

    // تغيير الحقول حسب المنصة المختارة
    function selectPlatform(element, platform) {
      document.querySelectorAll('.platform-item').forEach(item => item.classList.remove('selected'));
      element.classList.add('selected');
      document.getElementById('selectedPlatform').value = platform;

      const netsBox = document.getElementById('networks');
      const details = document.getElementById('walletDetails');
      const walletId = document.getElementById('walletId');
      const walletNetwork = document.getElementById('walletNetwork');
      const walletLabel = document.getElementById('walletLabel');
      const walletHint = document.getElementById('walletHint');

      // إعادة الضبط
      document.querySelectorAll('input[name="net"]').forEach(r => r.checked = false);
      document.getElementById('selectedNetwork').value = '';
      walletId.value = '';
      walletNetwork.value = '';

      details.style.display = 'block'; // نُظهر الصندوق عند اختيار منصة

      if (CRYPTO_PLATFORMS.includes(platform)) {
        netsBox.style.display = 'flex';
        walletLabel.innerHTML = '<i class="fas fa-id-card"></i> بيانات المحفظة الدولية';
        walletId.placeholder = 'عنوان التحويل / Memo (إن وُجد)';
        walletNetwork.placeholder = 'اسم الشبكة (مثال: TRC20 أو ERC20)';
        walletHint.textContent = 'أدخل عنوان الاستلام الصحيح، وتأكد من اختيار الشبكة المطابقة.';
        walletNetwork.style.display = '';
      } else if (platform === 'PayPal') {
        netsBox.style.display = 'none';
        walletLabel.innerHTML = '<i class="fas fa-id-card"></i> حساب باي بال';
        walletId.placeholder = 'البريد الإلكتروني لحساب PayPal';
        walletNetwork.placeholder = '';
        walletHint.textContent = 'اكتب الإيميل المرتبط بحساب باي بال.';
        walletNetwork.style.display = 'none';
      } else if (platform === 'Payeer') {
        netsBox.style.display = 'none';
        walletLabel.innerHTML = '<i class="fas fa-id-card"></i> حساب بايير';
        walletId.placeholder = 'Payeer ID أو البريد الإلكتروني';
        walletNetwork.placeholder = '';
        walletHint.textContent = 'أدخل الـ ID إن وجد، أو البريد الإلكتروني لحساب بايير.';
        walletNetwork.style.display = 'none';
      } else {
        netsBox.style.display = 'none';
        walletLabel.innerHTML = '<i class="fas fa-id-card"></i> بيانات الحساب';
        walletId.placeholder = 'المعرّف / الإيميل';
        walletNetwork.placeholder = 'اسم الشبكة (إن وُجد)';
        walletHint.textContent = '';
        walletNetwork.style.display = '';
      }
    }

    function setNetwork(radio){
      if (radio && radio.checked){
        document.getElementById('selectedNetwork').value = radio.value;
        const walletNetwork = document.getElementById('walletNetwork');
        if (walletNetwork && walletNetwork.style.display !== 'none') {
          walletNetwork.value = radio.value;
        }
      }
    }

    // ====== إدارة الأخطاء المنبثقة ======
    let targetFieldForError = null;

    function showError(fieldEl, msg){
      // تمييز الحقل واهتزازه
      clearErrors();
      if(fieldEl){
        fieldEl.classList.add('invalid','shake');
        setTimeout(()=>fieldEl.classList.remove('shake'), 500);
        fieldEl.scrollIntoView({behavior:'smooth', block:'center'});
        targetFieldForError = fieldEl;
      }else{
        targetFieldForError = null;
      }
      // عرض النافذة
      const errorMsg = document.getElementById('errorMsg');
      errorMsg.textContent = msg || 'يرجى إكمال الحقل المطلوب.';
      document.getElementById('errorModal').classList.add('active');
      // زر الذهاب للحقل
      const btn = document.getElementById('gotoFieldBtn');
      btn.onclick = function(){
        if(targetFieldForError){
          document.getElementById('errorModal').classList.remove('active');
          targetFieldForError.focus();
          targetFieldForError.scrollIntoView({behavior:'smooth', block:'center'});
          targetFieldForError.classList.add('shake');
          setTimeout(()=>targetFieldForError.classList.remove('shake'), 500);
        }else{
          document.getElementById('errorModal').classList.remove('active');
        }
      };
    }
    function closeError(){
      document.getElementById('errorModal').classList.remove('active');
    }
    function clearErrors(){
      document.querySelectorAll('.invalid').forEach(el=>el.classList.remove('invalid'));
    }

    // ====== التحقق وفتح نافذة التأكيد ======
    function confirmSend() {
      clearErrors();

      const name = document.getElementById('clientName');
      const phone = document.getElementById('clientPhone');
      const amountEl = document.getElementById('amount');
      const amount = normalizeNumber(amountEl.value);
      const methodVal = document.getElementById('selectedMethod').value || '';
      const platformVal = document.getElementById('selectedPlatform').value || '';
      const netsVisible = getComputedStyle(document.getElementById('networks')).display !== 'none';
      const walletBox = document.getElementById('walletDetails');
      const walletBoxVisible = getComputedStyle(walletBox).display !== 'none';
      const walletId = document.getElementById('walletId');
      const walletNetwork = document.getElementById('walletNetwork');
      const selectedNetwork = document.getElementById('selectedNetwork').value || '';

      // ترتيب التحقق.. أول ناقص نوقف عليه وننبه
      if (!name.value.trim()) {
        return showError(name, 'يرجى كتابة الاسم بالكامل.');
      }
      if (!phone.value.trim()) {
        return showError(phone, 'يرجى إدخال رقم الجوال.');
      }
      if (!amount || amount <= 0) {
        return showError(amountEl, 'يرجى إدخال المبلغ بشكل صحيح.');
      }
      if (!methodVal) {
        // ما عندنا input مباشر لطريقة الاستلام، فنبين رسالة وننزل لقسمه
        const firstMethod = document.querySelector('.deposit-methods');
        return showError(firstMethod, 'يرجى اختيار طريقة الاستلام.');
      }
      if (!platformVal) {
        const firstPlatform = document.querySelector('.platforms-grid');
        return showError(firstPlatform, 'يرجى اختيار المنصة.');
      }
      if (netsVisible && !selectedNetwork) {
        const nets = document.getElementById('networks');
        return showError(nets, 'يرجى اختيار الشبكة.');
      }
      if (walletBoxVisible && !walletId.value.trim()) {
        return showError(walletId, 'يرجى إدخال العنوان/المعرف المناسب لهذه المنصة.');
      }
      // إن كان حقل الشبكة النصي ظاهر ولم يحدد شيء
      if (walletBoxVisible && walletNetwork.style.display !== 'none' && !walletNetwork.value.trim() && netsVisible) {
        return showError(walletNetwork, 'يرجى كتابة اسم الشبكة أو اختيارها.');
      }

      // بناء الملخص
      const currencySel = document.getElementById('currency');
      const currencyText = currencySel.options[currencySel.selectedIndex].text;
      const result = document.getElementById('resultValue').textContent;
      const outLabel = document.getElementById('outCur').value.toUpperCase();

      const lines = [
        `👤 الاسم: ${name.value.trim()}`,
        `📞 الجوال: ${phone.value.trim()}`,
        `💱 العملة: ${currencyText}`,
        `💰 المبلغ: ${amount}`,
        `📊 الناتج: ${result} (${outLabel})`,
        `💼 طريقة الاستلام: ${methodVal}`,
        `🔗 المنصة: ${platformVal}`,
      ];
      if (selectedNetwork) lines.push(`🌐 الشبكة: ${selectedNetwork}`);
      if (walletId.value.trim()) lines.push(`🧾 المعرف/الإيميل: ${walletId.value.trim()}`);
      if (walletNetwork.value.trim() && !selectedNetwork) lines.push(`🌐 الشبكة: ${walletNetwork.value.trim()}`);

      document.getElementById('summaryBox').innerHTML = lines.join('<br>');
      document.getElementById('confirmModal').classList.add('active');
    }
    
    function closeModal() {
      document.getElementById('confirmModal').classList.remove('active');
    }
    
    function sendViaWhatsApp() {
      const name = document.getElementById('clientName').value.trim();
      const phone = document.getElementById('clientPhone').value.trim();
      const currencySel = document.getElementById('currency');
      const currencyText = currencySel.options[currencySel.selectedIndex].text;
      const amount = normalizeNumber(document.getElementById('amount').value);
      const result = document.getElementById('resultValue').textContent;
      const outLabel = document.getElementById('outCur').value.toUpperCase();
      const method = document.getElementById('selectedMethod').value;
      const platform = document.getElementById('selectedPlatform').value;
      const net = document.getElementById('selectedNetwork').value;

      const walletId = document.getElementById('walletId').value.trim();
      const walletNetwork = document.getElementById('walletNetwork').value.trim();

      const msg =
` *طلب بيع — فاست كوينز*

الاسم: ${name}
رقم الجوال: ${phone}
العملة المعروضة للبيع: ${currencyText}
الكمية: ${amount}
القيمة المتوقعة: ${result} (${outLabel})

طريقة الاستلام: ${method}
المنصة المُرسِل منها: ${platform}${net ? '\nالشبكة المختارة: ' + net : ''}${
(walletId ? '\nالمعرّف/الإيميل: ' + walletId : '')}${
(walletNetwork ? '\nاسم الشبكة: ' + walletNetwork : '')}

(تم الإرسال من واجهة بيع العملات)`;

      window.open('https://wa.me/967781400883?text=' + encodeURIComponent(msg), '_blank');
      closeModal();
    }
    
    // إغلاق النوافذ بالضغط خارجها
    document.getElementById('confirmModal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });
    document.getElementById('errorModal').addEventListener('click', function(e) {
      if (e.target === this) closeError();
    });

    // ESC لإغلاق النوافذ
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape'){
        closeModal();
        closeError();
      }
    });
  </script>
</body>
</html>